{% sw_extends '@Storefront/storefront/layout/cookie/cookie-configuration-group.html.twig' %}

{% block cookie_configuration_group %}

    {% if cookieGroup.cookie is defined or cookieGroup.entries is defined %}
        {% set tagManagerCookieConsentDeactivated = 0 %}
        {% set tagManagerGoogleAnalyticsAdsCookieConsentDeactivated = 0 %}
        {% set tagManagerCookieConsent = config('AcrisTagManagerAppCS.config.enableCookieConsentSupport') %}
        {% set tagManagerGoogleAnalyticsAdsCookieConsent = config('AcrisTagManagerAppCS.config.enableAdditionalGoogleCookieConsentSupport') %}
        {% for entry in cookieGroup.entries %}
            {% if entry.cookie == "acris-tag-manager" %}
                {% set tagManagerCookieConsentDeactivated = 1 and tagManagerCookieConsent == false %}
            {% endif %}
            {% if (entry.cookie == "acris-tag-manager-google-analytics-enabled" or entry.cookie == "acris-tag-manager-google-ads-enabled") and tagManagerGoogleAnalyticsAdsCookieConsent == false %}
                {% set tagManagerGoogleAnalyticsAdsCookieConsentDeactivated = 1 %}
            {% endif %}
        {% endfor %}
        {% if tagManagerCookieConsentDeactivated or tagManagerGoogleAnalyticsAdsCookieConsentDeactivated %}
            {# DO NOTHING #}
        {% else %}
            <div class="offcanvas-cookie-group">
                {% sw_include '@Storefront/storefront/layout/cookie/cookie-configuration-parent.html.twig' with {
                    parent: cookieGroup
                } only %}

                {% if cookieGroup.entries is not empty or cookieGroup.snippet_description is defined %}

                    {% set cookieGroupName = cookieGroup.snippet_name|replace({'cookie.': ''}) %}
                    {% if "acris" in cookieGroupName %}
                        {% set cookieGroupName = cookieGroup.snippet_name|replace({'.': '-'}) %}
                    {% endif %}
                    {% set cookieGroupId = 'offcanvas-cookie-entries-' ~ cookieGroupName %}

                    {% block cookie_configuration_group_collapse_button %}
                        <button type="button"
                                aria-label="{{ 'general.expand'|trans|sw_sanitize }}"
                                aria-controls="{{ cookieGroupId }}"
                                data-bs-toggle="collapse"
                                data-bs-target="#{{ cookieGroupId }}"
                                class="btn btn-link-inline offcanvas-cookie-entries-toggle">

                            {% sw_icon 'arrow-head-right' style {
                                size: 'sm',
                            } %}
                        </button>
                    {% endblock %}

                    <div id="{{ cookieGroupId }}" class="offcanvas-cookie-entries collapse">

                        {% if cookieGroup.snippet_description %}
                            <p>{{ cookieGroup.snippet_description|trans|sw_sanitize }}</p>
                        {% endif %}

                        {% for entry in cookieGroup.entries %}
                            {% sw_include '@Storefront/storefront/layout/cookie/cookie-configuration-child.html.twig' with {
                                child: entry, isRequired: cookieGroup.isRequired
                            } only %}
                        {% endfor %}
                    </div>
                {% endif %}
            </div>
        {% endif %}
    {% endif %}
{% endblock %}