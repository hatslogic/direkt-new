(function(){var t,e,r,n,s={270:function(){},60:function(t,e,r){var n=r(270);n.__esModule&&(n=n.default),"string"==typeof n&&(n=[[t.id,n,""]]),n.locals&&(t.exports=n.locals),r(346).Z("646a6b35",n,!0,{})},346:function(t,e,r){"use strict";function n(t,e){for(var r=[],n={},s=0;s<e.length;s++){var i=e[s],a=i[0],o={id:t+":"+s,css:i[1],media:i[2],sourceMap:i[3]};n[a]?n[a].parts.push(o):r.push(n[a]={id:a,parts:[o]})}return r}r.d(e,{Z:function(){return g}});var s="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!s)throw Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},a=s&&(document.head||document.getElementsByTagName("head")[0]),o=null,d=0,l=!1,c=function(){},u=null,p="data-vue-ssr-id",h="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(t,e,r,s){l=r,u=s||{};var a=n(t,e);return m(a),function(e){for(var r=[],s=0;s<a.length;s++){var o=i[a[s].id];o.refs--,r.push(o)}e?m(a=n(t,e)):a=[];for(var s=0;s<r.length;s++){var o=r[s];if(0===o.refs){for(var d=0;d<o.parts.length;d++)o.parts[d]();delete i[o.id]}}}}function m(t){for(var e=0;e<t.length;e++){var r=t[e],n=i[r.id];if(n){n.refs++;for(var s=0;s<n.parts.length;s++)n.parts[s](r.parts[s]);for(;s<r.parts.length;s++)n.parts.push(b(r.parts[s]));n.parts.length>r.parts.length&&(n.parts.length=r.parts.length)}else{for(var a=[],s=0;s<r.parts.length;s++)a.push(b(r.parts[s]));i[r.id]={id:r.id,refs:1,parts:a}}}}function f(){var t=document.createElement("style");return t.type="text/css",a.appendChild(t),t}function b(t){var e,r,n=document.querySelector("style["+p+'~="'+t.id+'"]');if(n){if(l)return c;n.parentNode.removeChild(n)}if(h){var s=d++;e=y.bind(null,n=o||(o=f()),s,!1),r=y.bind(null,n,s,!0)}else e=w.bind(null,n=f()),r=function(){n.parentNode.removeChild(n)};return e(t),function(n){n?(n.css!==t.css||n.media!==t.media||n.sourceMap!==t.sourceMap)&&e(t=n):r()}}var v=function(){var t=[];return function(e,r){return t[e]=r,t.filter(Boolean).join("\n")}}();function y(t,e,r,n){var s=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=v(e,s);else{var i=document.createTextNode(s),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}function w(t,e){var r=e.css,n=e.media,s=e.sourceMap;if(n&&t.setAttribute("media",n),u.ssrId&&t.setAttribute(p,e.id),s&&(r+="\n/*# sourceURL="+s.sources[0]+" */\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}}},i={};function a(t){var e=i[t];if(void 0!==e)return e.exports;var r=i[t]={id:t,exports:{}};return s[t](r,r.exports,a),r.exports}a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,{a:e}),e},a.d=function(t,e){for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="bundles/nimbitstracking/",window?.__sw__?.assetPath&&(a.p=window.__sw__.assetPath+"/bundles/nimbitstracking/"),t=JSON.parse('{"nimbits-tracking":{"date":{"format":"j. F Y","till":"bis"},"module":{"name":"Tracking","title":"Tracking"},"navigation":{"label":"Tracking","button":{"reload":"Daten neu laden","export":"CSV exportieren"}},"general":{"mainMenuItemGeneral":"Tracking","descriptionTextModule":"Mit diesem Modul k\xf6nnen Sie sehen, wie viele Benutzer \xfcber Referrer gekommen sind und wie viel Geld sie ausgeben."},"charts":{"registrations":{"options":{"header":"Registrierte Kunden nach Referrer","tooltip":"Registrierung(en)","legend":{"content":"Registrierung(en) durch","empty":"Registrierung(en) ohne Referrer","total":"Registrierung(en) gesamt"}},"empty":"Keine durch Referrer entstandene Registrierungen im gew\xe4hlten Zeitraum gefunden"},"orders":{"options":{"header":"Bestellungen nach Referrer","tooltip":"Bestellung(en)","legend":{"content":"Bestellung(en) durch","empty":"Bestellung(en) ohne Referrer","total":"Bestellung(en) gesamt"}},"empty":"Keine durch Referrer entstandene Bestellungen im gew\xe4hlten Zeitraum"},"sales":{"options":{"header":"Umsatz nach Referrer"},"series":{"name":"Umsatz"},"empty":"Keine durch Referrer entstandene Ums\xe4tze im gew\xe4hlten Zeitraum","noreferrer":"Ohne Referrer"},"requests":{"options":{"header":"Anfrage(n) nach Referrer","tooltip":"Anfrage(n)","legend":{"content":"Anfrage(n) durch","empty":"Anfrage(n) ohne Referrer","total":"Anfrage(n) gesamt"}},"empty":"Keine Anfragen im gew\xe4hlten Zeitraum"},"visitors":{"options":{"header":"Besucher nach Referrer","tooltip":"Besucher","legend":{"content":"Besucher durch","empty":"Besucher ohne Referrer","total":"Besucher gesamt"}},"empty":"Keine Besucher im gew\xe4hlten Zeitraum (Die Daten werden alle 5 Minuten aktualisiert.)"}},"subline":{"fiveMinuteReload":"Die Daten werden alle 5 Minuten aktualisiert"}}}'),e=JSON.parse('{"nimbits-tracking":{"date":{"format":"F j, Y","till":"till"},"module":{"name":"Tracking","title":"Tracking"},"navigation":{"label":"Tracking","button":{"reload":"Reload data","export":"Export CSV"}},"general":{"mainMenuItemGeneral":"Tracking","descriptionTextModule":"This module allows you to see how many users came through referrers and how much money they spend."},"charts":{"registrations":{"options":{"header":"Registrations by referrers","tooltip":"registration(s)","legend":{"content":"registration(s) through","empty":"registration(s) without referrer","total":"Total registration(s)"}},"empty":"No partnered registrations found in the selected period"},"orders":{"options":{"header":"Orders by referrers","tooltip":"order(s)","legend":{"content":"order(s) through","empty":"order(s) without referrer","total":"Total order(s)"}},"empty":"No partnered orders found in the selected period"},"sales":{"options":{"header":"Sales by referrers"},"series":{"name":"Sales"},"empty":"No partnered sales found in the selected period","noreferrer":"No referrer"},"requests":{"options":{"header":"Requests by referrer","tooltip":"request(s)","legend":{"content":"request(s) through","empty":"request(s) without referrer","total":"Total request(s)"}},"empty":"No requests found in the selected period"},"visitors":{"options":{"header":"Visitors by referrer","tooltip":"visitor(s)","legend":{"content":"visitor(s) through","empty":"visitor(s) without referrer","total":"Total visitor(s)"}},"empty":"No visitors found in the selected period (Data is updated every 5 minutes.)"}},"subline":{"fiveMinuteReload":"Data is updated every 5 minutes"}}}'),Shopware.Module.register("nimbits-tracking",{type:"plugin",name:"nimbits-tracking.module.name",title:"nimbits-tracking.module.title",description:"This module allows you to see how many users came through partners and how much money they spend.",color:"#6F58FF",icon:"default-chart-line",snippets:{"de-DE":t,"en-GB":e},routes:{dashboard:{component:"nimbits-tracking-dashboard",path:"dashboard"}},navigation:[{label:"nimbits-tracking.navigation.label",color:"#02d3ff",path:"nimbits.tracking.dashboard",icon:"default-chart-line",parent:"sw-marketing",position:100}]}),r=a(60),n=a.n(r),Shopware.Component.register("nimbits-tracking-dashboard",{template:'{% block nb_tracking_dashboard %}\r\n    <sw-page class="nb-tracking-dashboard">\r\n        <template #smart-bar-actions>\r\n            <sw-datepicker class="topbar-datepicker" :config="dates.config" v-model="dates.start"\r\n                           required></sw-datepicker>\r\n            <span class="topbar-text">{{ $tc(\'nimbits-tracking.date.till\') }}</span>\r\n            <sw-datepicker class="topbar-datepicker" :config="dates.config" v-model="dates.end"\r\n                           required></sw-datepicker>\r\n            <sw-button variant="context" :square="true" @click="getData">\r\n                <div :title="title.reload">\r\n                    <sw-icon name="default-arrow-360-right" color="#1a8bbc"></sw-icon>\r\n                </div>\r\n            </sw-button>\r\n            <sw-button variant="context" :square="true" :isLoading="exportCsvRunning" @click="exportCSV">\r\n                <div :title="title.exportCsv">\r\n                    <sw-icon name="default-action-circle-download" color="#1abc9c"></sw-icon>\r\n                </div>\r\n            </sw-button>\r\n        </template>\r\n        <template #content>\r\n            <sw-card-view>\r\n                <div class="row">\r\n                    <div class="col">\r\n                        <sw-card :isLoading="loading.registrations">\r\n                            <sw-chart\r\n                                    v-if="registrationsByPartnerSeries[0].data.length > 0"\r\n                                    :type="\'donut\'"\r\n                                    :series="registrationsByPartnerSeries"\r\n                                    :options="registrationsByPartnerOptions">\r\n                            </sw-chart>\r\n                            <div v-else class="empty-chart">\r\n                                <p>\r\n                                    {{ $tc(\'nimbits-tracking.charts.registrations.empty\') }}\r\n                                </p>\r\n                            </div>\r\n                        </sw-card>\r\n                    </div>\r\n                    <div class="col">\r\n                        <sw-card :isLoading="loading.orders">\r\n                            <sw-chart\r\n                                    v-if="ordersByPartnerSeries[0].data.length > 0"\r\n                                    :type="\'donut\'"\r\n                                    :series="ordersByPartnerSeries"\r\n                                    :options="ordersByPartnerOptions">\r\n                            </sw-chart>\r\n                            <div v-else class="empty-chart">\r\n                                <p>\r\n                                    {{ $tc(\'nimbits-tracking.charts.orders.empty\') }}\r\n                                </p>\r\n                            </div>\r\n                        </sw-card>\r\n                    </div>\r\n                    <div class="col">\r\n                        <sw-card :isLoading="loading.sales">\r\n                            <sw-chart\r\n                                    v-if="salesByPartnerSeries[0].data.length > 0"\r\n                                    :type="\'bar\'"\r\n                                    :series="salesByPartnerSeries"\r\n                                    :options="salesByPartnerOptions">\r\n                            </sw-chart>\r\n                            <div v-else class="empty-chart">\r\n                                <p>\r\n                                    {{ $tc(\'nimbits-tracking.charts.sales.empty\') }}\r\n                                </p>\r\n                            </div>\r\n                        </sw-card>\r\n                    </div>\r\n                </div>\r\n                <div class="row">\r\n                    <div class="col">\r\n                        <sw-card :isLoading="loading.visitors">\r\n                            <sw-chart\r\n                                    v-if="visitorsByPartnerSeries[0].data.length > 0"\r\n                                    :type="\'donut\'"\r\n                                    :series="visitorsByPartnerSeries"\r\n                                    :options="visitorsByPartnerOptions">\r\n                            </sw-chart>\r\n                            <div v-else class="empty-chart">\r\n                                <p>\r\n                                    {{ $tc(\'nimbits-tracking.charts.visitors.empty\') }}\r\n                                </p>\r\n                            </div>\r\n                            <div class="nb-tracking-chart-subline" v-if="visitorsByPartnerSeries[0].data.length > 0">\r\n                                {{ $tc(\'nimbits-tracking.subline.fiveMinuteReload\') }}\r\n                            </div>\r\n                        </sw-card>\r\n                    </div>\r\n                    <div class="col">\r\n                        <sw-card :isLoading="loading.requests">\r\n                            <sw-chart\r\n                                    v-if="requestsByPartnerSeries[0].data.length > 0"\r\n                                    :type="\'donut\'"\r\n                                    :series="requestsByPartnerSeries"\r\n                                    :options="requestsByPartnerOptions">\r\n                            </sw-chart>\r\n                            <div v-else class="empty-chart">\r\n                                <p>\r\n                                    {{ $tc(\'nimbits-tracking.charts.requests.empty\') }}\r\n                                </p>\r\n                            </div>\r\n                            <div class="nb-tracking-chart-subline" v-if="requestsByPartnerSeries[0].data.length > 0">\r\n                                {{ $tc(\'nimbits-tracking.subline.fiveMinuteReload\') }}\r\n                            </div>\r\n                        </sw-card>\r\n                    </div>\r\n                </div>\r\n            </sw-card-view>\r\n            <div class="hidden">\r\n                <a id="nb-tracking-download" v-if="download.content" :href="download.content"\r\n                   :download="download.name"></a>\r\n            </div>\r\n        </template>\r\n    </sw-page>\r\n{% endblock %}\r\n',styles:n(),snippets:{"de-DE":t,"en-GB":e},metaInfo(){return{title:this.$createTitle()}},data(){let t=this,e=new Date,r=new Date;r.setMonth(r.getMonth()-1);let n={altInput:!0,altFormat:t.$tc("nimbits-tracking.date.format"),dateFormat:"Y-m-d"};return{timeoutId:null,exportCsvRunning:!1,download:{content:null,name:null},title:{exportCsv:t.$tc("nimbits-tracking.navigation.button.export"),reload:t.$tc("nimbits-tracking.navigation.button.reload")},dates:{end:e.toISOString(),start:r.toISOString(),config:n},loading:{registrations:!0,orders:!0,sales:!0,visitors:!0,requests:!0},registrationsByPartnerOptions:{title:{text:t.$tc("nimbits-tracking.charts.registrations.options.header")},dataLabels:{enabled:!0,formatter:function(t,e){return e.w.config.series[e.seriesIndex]}},tooltip:{y:{formatter:function(e){return e+" "+t.$tc("nimbits-tracking.charts.registrations.options.tooltip")}}},legend:{formatter:function(e,r){return e.length>0?[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.registrations.options.legend.content")," ",e]:[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.registrations.options.legend.empty")]}},plotOptions:{pie:{donut:{labels:{show:!0,name:{formatter:function(e){return e===t.$tc("nimbits-tracking.charts.registrations.options.legend.total")?e:e.length>0?t.$tc("nimbits-tracking.charts.registrations.options.legend.content")+" "+e:t.$tc("nimbits-tracking.charts.registrations.options.legend.empty")}},total:{show:!0,label:t.$tc("nimbits-tracking.charts.registrations.options.legend.total"),color:"#52667a"}}}}}},registrationsByPartnerSeries:[{data:[]}],ordersByPartnerOptions:{title:{text:t.$tc("nimbits-tracking.charts.orders.options.header")},dataLabels:{enabled:!0,formatter:function(t,e){return e.w.config.series[e.seriesIndex]}},tooltip:{y:{formatter:function(e){return e+" "+t.$tc("nimbits-tracking.charts.orders.options.tooltip")}}},legend:{formatter:function(e,r){return e.length>0?[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.orders.options.legend.content")," ",e]:[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.orders.options.legend.empty")]}},plotOptions:{pie:{donut:{labels:{show:!0,name:{formatter:function(e){return e===t.$tc("nimbits-tracking.charts.orders.options.legend.total")?e:e.length>0?t.$tc("nimbits-tracking.charts.orders.options.legend.content")+" "+e:t.$tc("nimbits-tracking.charts.orders.options.legend.empty")}},total:{show:!0,label:t.$tc("nimbits-tracking.charts.orders.options.legend.total"),color:"#52667a"}}}}}},ordersByPartnerSeries:[{data:[]}],salesByPartnerOptions:{title:{text:t.$tc("nimbits-tracking.charts.sales.options.header")},plotOptions:{bar:{distributed:!0},dataLabels:{position:"center"}},legend:{show:!1},dataLabels:{enabled:!0,formatter:function(t){return Shopware.Utils.format.currency(Math.round((t+Number.EPSILON)*100)/100,Shopware.Context.app.systemCurrencyISOCode)}},tooltip:{y:{formatter:function(t){return Shopware.Utils.format.currency(Math.round((t+Number.EPSILON)*100)/100,Shopware.Context.app.systemCurrencyISOCode)}}},xaxis:{labels:{formatter:function(e){return e.length>0?e:t.$tc("nimbits-tracking.charts.sales.noreferrer")}}},yaxis:{labels:{formatter:function(t){return t.toFixed(0)}}}},salesByPartnerSeries:[{name:t.$tc("nimbits-tracking.charts.sales.series.name"),data:[]}],visitorsByPartnerOptions:{title:{text:t.$tc("nimbits-tracking.charts.visitors.options.header")},dataLabels:{enabled:!0,formatter:function(t,e){return e.w.config.series[e.seriesIndex]}},tooltip:{y:{formatter:function(e){return e+" "+t.$tc("nimbits-tracking.charts.visitors.options.tooltip")}}},legend:{formatter:function(e,r){return e.length>0?[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.visitors.options.legend.content")," ",e]:[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.visitors.options.legend.empty")]}},plotOptions:{pie:{donut:{labels:{show:!0,name:{formatter:function(e){return e===t.$tc("nimbits-tracking.charts.visitors.options.legend.total")?e:e.length>0?t.$tc("nimbits-tracking.charts.visitors.options.legend.content")+" "+e:t.$tc("nimbits-tracking.charts.visitors.options.legend.empty")}},total:{show:!0,label:t.$tc("nimbits-tracking.charts.visitors.options.legend.total"),color:"#52667a"}}}}}},visitorsByPartnerSeries:[{data:[]}],requestsByPartnerOptions:{title:{text:t.$tc("nimbits-tracking.charts.requests.options.header")},dataLabels:{enabled:!0,formatter:function(t,e){return e.w.config.series[e.seriesIndex]}},tooltip:{y:{formatter:function(e){return e+" "+t.$tc("nimbits-tracking.charts.requests.options.tooltip")}}},legend:{formatter:function(e,r){return e.length>0?[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.requests.options.legend.content")," ",e]:[r.w.globals.series[r.seriesIndex]," ",t.$tc("nimbits-tracking.charts.requests.options.legend.empty")]}},plotOptions:{pie:{donut:{labels:{show:!0,name:{formatter:function(e){return e===t.$tc("nimbits-tracking.charts.requests.options.legend.total")?e:e.length>0?t.$tc("nimbits-tracking.charts.requests.options.legend.content")+" "+e:t.$tc("nimbits-tracking.charts.requests.options.legend.empty")}},total:{show:!0,label:t.$tc("nimbits-tracking.charts.requests.options.legend.total"),color:"#52667a"}}}}}},requestsByPartnerSeries:[{data:[]}],httpClient:Shopware.Application.getContainer("init").httpClient}},computed:{datePickerStartDate(){return this.dates.start},datePickerEndDate(){return this.dates.end}},watch:{datePickerStartDate(){this.getData()},datePickerEndDate(){this.getData()}},methods:{async exportCSV(){this.exportCsvRunning=!0,this.httpClient.post("nimbits/tracking/export-csv",{startDate:this.dates.start,endDate:this.dates.end},{headers:{Authorization:`Bearer ${Shopware.Context.api.authToken.access}`}}).then(t=>{200===t.status&&this.downloadReceivedFile(t),this.exportCsvRunning=!1})},downloadReceivedFile(t){let e=t.headers["content-disposition"];if(e&&-1!==e.indexOf("attachment")){let t=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(e);null!=t&&t[1]&&(this.download.name=t[1].replace(/['"]/g,""))}this.download.content="data:text/csv;charset=utf-8,"+encodeURIComponent(t.data),setTimeout(()=>document.getElementById("nb-tracking-download").click(),100)},async getData(){null!==this.timeoutId&&window.clearTimeout(this.timeoutId),this.httpClient.post("nimbits/tracking/registrations",{startDate:this.dates.start,endDate:this.dates.end},{headers:{Authorization:`Bearer ${Shopware.Context.api.authToken.access}`}}).then(t=>{200===t.status&&(this.registrationsByPartnerSeries[0].data=t.data.result.registrations,this.loading.registrations=!1)}),this.httpClient.post("nimbits/tracking/orders",{startDate:this.dates.start,endDate:this.dates.end},{headers:{Authorization:`Bearer ${Shopware.Context.api.authToken.access}`}}).then(t=>{200===t.status&&(this.salesByPartnerSeries[0].data=t.data.result.sales,this.loading.sales=!1,this.ordersByPartnerSeries[0].data=t.data.result.orders,this.loading.orders=!1)}),this.httpClient.post("nimbits/tracking/visitors",{startDate:this.dates.start,endDate:this.dates.end},{headers:{Authorization:`Bearer ${Shopware.Context.api.authToken.access}`}}).then(t=>{200===t.status&&(this.visitorsByPartnerSeries[0].data=t.data.result.visitors,this.loading.visitors=!1,this.requestsByPartnerSeries[0].data=t.data.result.requests,this.loading.requests=!1)}),this.timeoutId=window.setTimeout(()=>this.getData(),6e4)}},mounted(){this.getData()}})})();